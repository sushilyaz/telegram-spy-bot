package com.spybot.service.handler;

import com.pengrad.telegrambot.model.Message;
import com.spybot.service.telegram.TelegramBotService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;

@Service
@Slf4j
@RequiredArgsConstructor
public class CommandHandler {

    private TelegramBotService botService;

    public void setBotService(TelegramBotService botService) {
        this.botService = botService;
    }

    public void handleStartCommand(Message message) {
        Long chatId = message.chat().id();
        String userName = message.from().firstName();

        String welcomeMessage = String.format("""
                ğŸ‘‹ <b>ĞŸÑ€Ğ¸Ğ²ĞµÑ‚, %s!</b>

                Ğ¯ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑ ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½Ğ½Ñ‹Ğµ Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½Ñ‘Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ² Ñ‚Ğ²Ğ¾Ğ¸Ñ… Ñ‡Ğ°Ñ‚Ğ°Ñ….

                â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                <b>âš¡ Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ</b>
                â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                â€¢ Telegram Premium
                â€¢ Telegram Business (Ğ² Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ñ…)

                â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                <b>ğŸ”§ ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ</b>
                â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                <b>ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸</b> â†’ <b>Telegram Business</b> â†’ <b>Ğ§Ğ°Ñ‚Ğ±Ğ¾Ñ‚Ñ‹</b> â†’ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ¼ĞµĞ½Ñ â†’ ÑƒĞºĞ°Ğ¶Ğ¸ Ñ‡Ğ°Ñ‚Ñ‹

                â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                <b>ğŸ“¬ Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹</b>
                â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                ğŸ—‘ <b>Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¾:</b>
                <i>Ğ§Ğ°Ñ‚: Ğ˜Ğ¼Ñ ÑĞ¾Ğ±ĞµÑĞµĞ´Ğ½Ğ¸ĞºĞ°</i>
                <i>Ğ¢ĞµĞºÑÑ‚ Ğ¸Ğ»Ğ¸ Ğ¼ĞµĞ´Ğ¸Ğ°, ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğµ ÑƒĞ´Ğ°Ğ»Ğ¸Ğ»Ğ¸</i>

                âœï¸ <b>Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾:</b>
                <i>Ğ‘Ñ‹Ğ»Ğ¾:</i> ÑÑ‚Ğ°Ñ€Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚
                <i>Ğ¡Ñ‚Ğ°Ğ»Ğ¾:</i> Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚

                â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                <b>ğŸ”’ Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ</b>
                â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                Ğ’ÑĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ ÑˆĞ¸Ñ„Ñ€ÑƒÑÑ‚ÑÑ AES-256.
                Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ â€” 30 Ğ´Ğ½ĞµĞ¹, Ğ·Ğ°Ñ‚ĞµĞ¼ Ğ°Ğ²Ñ‚Ğ¾-ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ.

                /help â€” Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ°Ñ ÑĞ¿Ñ€Ğ°Ğ²ĞºĞ°
                """, escapeHtml(userName != null ? userName : "Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ"));

        botService.sendTextMessage(chatId, welcomeMessage);
        log.info("action=start_command_handled, user_id={}", message.from().id());
    }

    public void handleHelpCommand(Message message) {
        Long chatId = message.chat().id();

        String helpMessage = """
                ğŸ“– <b>ĞŸĞ¾Ğ»Ğ½Ğ°Ñ ÑĞ¿Ñ€Ğ°Ğ²ĞºĞ°</b>

                â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                <b>ğŸ“¸ ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ Ñ‚Ğ¸Ğ¿Ñ‹</b>
                â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                â€¢ Ğ¢ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
                â€¢ Ğ¤Ğ¾Ñ‚Ğ¾ Ğ¸ Ğ²Ğ¸Ğ´ĞµĞ¾
                â€¢ Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ¸ Ñ„Ğ°Ğ¹Ğ»Ñ‹
                â€¢ Ğ“Ğ¾Ğ»Ğ¾ÑĞ¾Ğ²Ñ‹Ğµ Ğ¸ Ğ²Ğ¸Ğ´ĞµĞ¾ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
                â€¢ Ğ¡Ñ‚Ğ¸ĞºĞµÑ€Ñ‹

                â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                <b>âš ï¸ ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ</b>
                â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                â€¢ Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ñ… Ñ‡Ğ°Ñ‚Ğ°Ñ…
                â€¢ ĞÑƒĞ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· Telegram Business
                â€¢ Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ¾Ğ²Ñ‹Ğµ Ñ‡Ğ°Ñ‚Ñ‹ Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ
                â€¢ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ <b>30 Ğ´Ğ½ĞµĞ¹</b>

                â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                <b>â“ FAQ</b>
                â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                <b>Q:</b> ĞĞµ Ğ¿Ñ€Ğ¸Ñ…Ğ¾Ğ´ÑÑ‚ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ?
                <b>A:</b> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ, Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½ Ğ»Ğ¸ Ğ±Ğ¾Ñ‚ Ğ² Telegram Business Ğ¸ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ñ‹ Ğ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ñ‹Ğµ Ñ‡Ğ°Ñ‚Ñ‹.

                <b>Q:</b> Ğ¡Ğ¾Ğ±ĞµÑĞµĞ´Ğ½Ğ¸Ğº ÑƒĞ·Ğ½Ğ°ĞµÑ‚ Ğ¾ Ğ±Ğ¾Ñ‚Ğµ?
                <b>A:</b> ĞĞµÑ‚, Ğ±Ğ¾Ñ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ ÑĞºÑ€Ñ‹Ñ‚Ğ¾.

                <b>Q:</b> ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ?
                <b>A:</b> Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğµ, Ñ‡Ñ‚Ğ¾ Ğ±Ñ‹Ğ»Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğ±Ğ¾Ñ‚Ğ°.

                â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                <b>ğŸ›  ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹</b>
                â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                /start â€” Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹
                /help â€” ÑÑ‚Ğ° ÑĞ¿Ñ€Ğ°Ğ²ĞºĞ°
                """;

        botService.sendTextMessage(chatId, helpMessage);
        log.info("action=help_command_handled, user_id={}", message.from().id());
    }

    private String escapeHtml(String text) {
        if (text == null) return "";
        return text
                .replace("&", "&amp;")
                .replace("<", "&lt;")
                .replace(">", "&gt;");
    }
}
